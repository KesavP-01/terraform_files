resources:
  jobs:
    juneau_job: # e.g., my_sample_job
      name: "${var.environment_prefix} juneau"
      
      schedule:
        quartz_cron_expression: 0 0 9 ? * MON-FRI # [seconds minutes hours day-of-month month day-of-week [year]], e.g., 10 AM PST daily 
        timezone_id: "America/Los_Angeles" # UTC|America/Los_Angeles|America/Denver|America/Chicago|America/New_York|
        pause_status: "${var.job_pause_status}"

      email_notifications:
        # Standard notifications 
        on_failure: "${var.default_failure_emails}" 
        # on_success: 
        #   - "${var.default_on_success_emails}" 
        # on_start:
        #   - "${var.default_on_start_emails}" 

      tags:
        aag-team: "DataScience" # OPTIONS: [Commercial_Analytics|ITS_Dataservices_DAP|ITS_Dataservices_EDW_Commercial|ITS_Dataservices_EDW_Operations]
        project: "Analytics" # NAME OF YOUR PRODUCT e.g. Forecast
        author: "Sai Kesav Kumar" 

      webhook_notifications:
        on_failure:
          - id: "${var.zenoss_function}" 
      notification_settings:
        no_alert_for_skipped_runs: true
        no_alert_for_canceled_runs: true

      # All tasks below should use 'job_cluster_key: my_workflow_cluster'
      job_clusters:
        - job_cluster_key: juneau #  i.e., my_workflow_cluster
          new_cluster:
            spark_version: "${var.spark_version}" 
            node_type_id: "Standard_DS3_v2"    
            num_workers: 1
            azure_attributes:
              first_on_demand: 1
              availability: SPOT_WITH_FALLBACK_AZURE
              spot_bid_max_price: 100
            enable_elastic_disk: true
            policy_id: "${var.job_cluster_policy_id}"
            data_security_mode: SINGLE_USER
            runtime_engine: PHOTON
            custom_tags:
              aag-team: "DataScience" #[ITS_Dataservices_DAP|ITS_Dataservices_EDW_Commercial|ITS_Dataservices_EDW_Operations] 
              projectcategory: Analytics #[Enterprise| Analytics|RTB|eComm|AI|DataScience] 
              project: Analytics #[LMS|PERKS|ATModernization] 
              workstream: Analytics_Transformation #[ DLT Bookings| EDWRevenueMigration|GuestLoyaltyProfiles] 
              Workloadtype: DailyLoad #[DailyLoad| HistoricalLoad| Validation| DataFix]               

      tasks:
        # --- Task 1: Example Initial Task ---
        - task_key: juneau_task # Use a descriptive key, e.g., ingestion_task
          notebook_task:
            notebook_path: "${workspace.root_path}/files/notebooks/industry_schedule"
          #python_paths:
          # - "../../../../src"
            # base_parameters: # Optional: Pass parameters to the notebook
            #   source_system: "SAP"
            #   ingest_date: "{{job.start_date}}" # Example dynamic parameter

          job_cluster_key: juneau #  i.e., my_workflow_cluster
          libraries: #  Task-specific libraries
            - pypi:
                package: "cx_Oracle==8.3.0" 

        # --- Task 2: Example Processing Task ---
        - task_key: rulesbased_forecast # Use a descriptive key, e.g., processing_task
          depends_on:
            - task_key: juneau_task # Depends on Task 1 completion

          notebook_task:
            notebook_path: "${workspace.root_path}/files/notebooks/rulesbased_forecast_excel"

          job_cluster_key: juneau #  i.e., my_workflow_cluster
          libraries: 
            - pypi:
                package: "openpyxl"

        # --- Task 3: Example Reporting Task ---
        - task_key: excel_pass_condition
          depends_on:
            - task_key: rulesbased_forecast # Depends on Task 2 completion
          condition_task:
            op: EQUAL_TO
            left: "{{tasks.rulesbased_forecast.values.pass_condition}}"
            right: "true"
        
        - task_key: oa_market_data
          depends_on:
            - task_key: excel_pass_condition
              outcome: "true"
          notebook_task:
            notebook_path: "${workspace.root_path}/files/notebooks/oa_market_data"

          job_cluster_key: juneau #  i.e., my_workflow_cluster
          libraries:
            - pypi:
                package: "requests==2.28.1" 

      run_as: 
        service_principal_name: "${var.service_principal_name}" 